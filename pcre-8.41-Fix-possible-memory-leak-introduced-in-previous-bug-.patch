From bfd4f2b52faba20be338e06ac23cb1061ec4c777 Mon Sep 17 00:00:00 2001
From: ph10 <ph10@2f5784b3-3f2a-0410-8824-cb99058d5e15>
Date: Sun, 22 Oct 2017 16:19:42 +0000
Subject: [PATCH 2/2] Fix possible memory leak introduced in previous bug fix.
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

git-svn-id: svn://vcs.exim.org/pcre/code/trunk@1713 2f5784b3-3f2a-0410-8824-cb99058d5e15
Signed-off-by: Petr Písař <ppisar@redhat.com>
---
 pcregrep.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/pcregrep.c b/pcregrep.c
index d4a5fb5..a81c88d 100644
--- a/pcregrep.c
+++ b/pcregrep.c
@@ -2253,8 +2253,9 @@ if (isdirectory(pathname))
       if (fnlength > 2048)
         {
         fprintf(stderr, "pcre2grep: recursive filename is too long\n");
-        return 2;  
-        }           
+        rc = 2;
+        break;
+        }
       sprintf(buffer, "%s%c%s", pathname, FILESEP, nextfile);
       frc = grep_or_recurse(buffer, dir_recurse, FALSE);
       if (frc > 1) rc = frc;
-- 
2.13.6

